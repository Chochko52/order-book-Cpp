# Order Book Engine (C++)

Този проект реализира търговска книга на ниво цена/обем на C++ със съпътстващ уеб интерфейс в Streamlit. Основният бинарен файл `OrderBookFinal` обработва поръчки в реално време, а файлът `app.py` визуализира състоянието на книгата и изпраща команди чрез файлов интерфейс.

## Основни възможности
- Поддържани типове поръчки: Good‑Until‑Cancel (GTC), Fill‑And‑Kill (FAK), Fill‑Or‑Kill (FOK), Good‑For‑Day (GFD) и Market (MKT).
- Странични поръчки (buy/sell) с агрегация на нива и автоматично съпоставяне (matching) при добавяне или модифициране.
- Цикъл за изчистване на GFD поръчки в края на деня и коректно управление на отменени/изпълнени заявки.
- Публикуване на състоянието към `book_data.json`, което позволява директна визуализация в уеб интерфейса.
- Проверка на интегритет и запис на статуса в `status.json` (използва се от панела „System Check“).

## Структура на репозитория
- `main.cpp` – ядро на order book двигателя и файлов интерфейс за команди/статус/изходни данни.
- `stress-test.cpp` – самостоятелен бинарник за натоварващи тестове и симулации (изгражда се като `OrderBookApp`).
- `app.py` – Streamlit UI за подаване на поръчки, отмяна/модификация и визуализация на книгата.
- `book_data.json`, `commands.txt`, `status.json` – файлове за комуникация между C++ двигателя и уеб UI (генерират се/презаписват се по време на работа).

## Изисквания
- CMake ≥ 3.30 и компилатор с поддръжка на C++26.
- Python 3.9+ с пакети `streamlit` и `pandas` за уеб интерфейса.

## Компилация и стартиране на C++ двигателя
1. Генериране на билд файлове:
   ```bash
   cmake -S . -B build
   ```
2. Компилация:
   ```bash
   cmake --build build
   ```
3. Стартиране на order book двигателя (работи като файлов сървър за UI-то):
   ```bash
   ./build/OrderBookFinal
   ```

## Стартиране на Streamlit интерфейса
1. Инсталирайте зависимостите (препоръчително във виртуална среда):
   ```bash
   pip install streamlit pandas
   ```
2. Пуснете уеб приложението (изисква работещ двигател в същата директория, за да обменя файлове):
   ```bash
   streamlit run app.py
   ```
3. Интерфейсът използва следните файлове в текущата папка:
   - `commands.txt` – UI записва команди, които C++ процесът изпълнява.
   - `book_data.json` – C++ публикува текущите нива и активни поръчки; UI ги визуализира.
   - `status.json` – резултат от системната проверка (панел „System Check“).

## Синтаксис на командите (конзолно или през UI)
- Добавяне на поръчка:
  - Лимит/ден/условни: `add [GTC|FAK|FOK|GFD] <buy|sell> <price> <quantity>`
  - Пазарна: `add MKT <buy|sell> <quantity>`
- Отмяна: `cancel <orderId>`
- Модификация: `modify <orderId> <buy|sell> <newPrice> <newQty>`
- Интегритетна проверка: `check`

## Как да добавя поръчка
1. Уверете се, че C++ двигателят работи (`./build/OrderBookFinal`) и се намира в същата директория като `commands.txt`.
2. Изберете метод за въвеждане:
   - **Конзола**: изпълнете команда като `echo "add GTC buy 101.5 50" >> commands.txt` или използвайте интерактивно въвеждане в терминала, ако бинарникът приема вход от stdin.
   - **Streamlit UI**: стартирайте `streamlit run app.py`, попълнете формата „Add Order“ и натиснете „Submit“. Интерфейсът записва еквивалентната команда в `commands.txt`.
3. Изпратената команда се прочита от двигателя, който при възможност съпоставя ордъра с насрещни заявки и актуализира `book_data.json`. Визуализацията в UI-то се обновява автоматично при следващия рефреш.

Поръчките се изпълняват автоматично при възможност за съвпадение, като изпълнените сделки се отпечатват в конзолата. За целите на демо интерфейса модификациите очакват да знаете страната (buy/sell) на поръчката, което се проследява на база последно подадения тип.

## Как да push-нете промените (пример с `README.md`)
1. Проверете кои файлове са променени:
   ```bash
   git status
   ```
2. Добавете новия/редактиран файл към стейджа (тук `README.md`):
   ```bash
   git add README.md
   ```
3. Създайте комит с кратко описание на промяната:
   ```bash
   git commit -m "Добавя инструкции за push"
   ```
4. Изпратете комита към отдалечения клон (заменете `origin`/`main` според вашата конфигурация):
   ```bash
   git push origin main
   ```
5. Ако работите в отделен клон (напр. `feature/docs`), първо го публикувайте:
   ```bash
   git push -u origin feature/docs
   ```

## Съвети за разработка
- Поддържайте всички файлове (`commands.txt`, `book_data.json`, `status.json`) в същата работна директория и/или монтиран общ volume при контейнеризиране.
- При нужда от stress тестове, компилирайте и стартирайте `OrderBookApp` (`stress-test.cpp`) за генериране на голям брой случайни поръчки.
- Кодът използва мултитрединг за GFD цикъла; при добавяне на нови функции спазвайте заключванията (`ordersMutex_`).
